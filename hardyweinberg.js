
theoretical = [{ 'aa': 1.0, 'p': 0.0, 'aA': 0.0, 'AA': 0.0 }, { 'aa': 0.97990001020304063, 'p': 0.010101010101010102, 'aA': 0.019997959391898787, 'AA': 0.0001020304050607081 }, { 'aa': 0.9600040812162024, 'p': 0.020202020202020204, 'aA': 0.03958779716355474, 'AA': 0.00040812162024283241 }, { 'aa': 0.94031221303948587, 'p': 0.030303030303030304, 'aA': 0.058769513314967867, 'AA': 0.00091827364554637292 }, { 'aa': 0.92082440567289048, 'p': 0.040404040404040407, 'aA': 0.07754310784613816, 'AA': 0.0016324864809713297 }, { 'aa': 0.90154065911641668, 'p': 0.050505050505050511, 'aA': 0.095908580757065612, 'AA': 0.002550760126517703 }, { 'aa': 0.88246097337006435, 'p': 0.060606060606060608, 'aA': 0.11386593204775024, 'AA': 0.0036730945821854917 }, { 'aa': 0.86358534843383328, 'p': 0.070707070707070718, 'aA': 0.13141516171819204, 'AA': 0.0049994898479746985 }, { 'aa': 0.84491378430772379, 'p': 0.080808080808080815, 'aA': 0.14855626976839101, 'AA': 0.0065299459238853186 }, { 'aa': 0.82644628099173545, 'p': 0.090909090909090912, 'aA': 0.16528925619834711, 'AA': 0.0082644628099173556 }, { 'aa': 0.8081828384858688, 'p': 0.10101010101010102, 'aA': 0.18161412100806043, 'AA': 0.010203040506070812 }, { 'aa': 0.79012345679012341, 'p': 0.11111111111111112, 'aA': 0.19753086419753085, 'AA': 0.01234567901234568 }, { 'aa': 0.7722681359044995, 'p': 0.12121212121212122, 'aA': 0.21303948576675849, 'AA': 0.014692378328741967 }, { 'aa': 0.75461687582899717, 'p': 0.13131313131313133, 'aA': 0.22813998571574332, 'AA': 0.017243138455259672 }, { 'aa': 0.73716967656361587, 'p': 0.14141414141414144, 'aA': 0.2428323640444853, 'AA': 0.019997959391898794 }, { 'aa': 0.71992653810835638, 'p': 0.15151515151515152, 'aA': 0.25711662075298441, 'AA': 0.022956841138659322 }, { 'aa': 0.70288746046321793, 'p': 0.16161616161616163, 'aA': 0.27099275584124072, 'AA': 0.026119783695541274 }, { 'aa': 0.68605244362820117, 'p': 0.17171717171717174, 'aA': 0.28446076930925418, 'AA': 0.029486787062544647 }, { 'aa': 0.66942148760330566, 'p': 0.18181818181818182, 'aA': 0.2975206611570248, 'AA': 0.033057851239669422 }, { 'aa': 0.65299459238853175, 'p': 0.19191919191919193, 'aA': 0.31017243138455264, 'AA': 0.036832976226915629 }, { 'aa': 0.63677175798387919, 'p': 0.20202020202020204, 'aA': 0.32241607999183763, 'AA': 0.040812162024283248 }, { 'aa': 0.62075298438934801, 'p': 0.21212121212121213, 'aA': 0.33425160697887968, 'AA': 0.044995408631772274 }, { 'aa': 0.60493827160493829, 'p': 0.22222222222222224, 'aA': 0.34567901234567905, 'AA': 0.04938271604938272 }, { 'aa': 0.58932761963064983, 'p': 0.23232323232323235, 'aA': 0.35669829609223552, 'AA': 0.053974084277114594 }, { 'aa': 0.57392102846648296, 'p': 0.24242424242424243, 'aA': 0.36730945821854916, 'AA': 0.058769513314967867 }, { 'aa': 0.55871849811243735, 'p': 0.25252525252525254, 'aA': 0.37751249872461995, 'AA': 0.063769003162942567 }, { 'aa': 0.54372002856851342, 'p': 0.26262626262626265, 'aA': 0.38730741761044796, 'AA': 0.068972553821038687 }, { 'aa': 0.52892561983471076, 'p': 0.27272727272727276, 'aA': 0.39669421487603312, 'AA': 0.074380165289256214 }, { 'aa': 0.51433527191102946, 'p': 0.28282828282828287, 'aA': 0.4056728905213754, 'AA': 0.079991837567595175 }, { 'aa': 0.49994898479746963, 'p': 0.29292929292929293, 'aA': 0.41424344454647483, 'AA': 0.085807570656055501 }, { 'aa': 0.48576675849403128, 'p': 0.30303030303030304, 'aA': 0.42240587695133153, 'AA': 0.091827364554637289 }, { 'aa': 0.47178859300071418, 'p': 0.31313131313131315, 'aA': 0.43016018773594533, 'AA': 0.098051219263340483 }, { 'aa': 0.45801448831751851, 'p': 0.32323232323232326, 'aA': 0.4375063769003163, 'AA': 0.1044791347821651 }, { 'aa': 0.44444444444444442, 'p': 0.33333333333333337, 'aA': 0.44444444444444448, 'AA': 0.11111111111111113 }, { 'aa': 0.4310784613814917, 'p': 0.34343434343434348, 'aA': 0.45097439036832981, 'AA': 0.11794714825017859 }, { 'aa': 0.41791653912866028, 'p': 0.35353535353535359, 'aA': 0.45709621467197226, 'AA': 0.12498724619936745 }, { 'aa': 0.4049586776859504, 'p': 0.36363636363636365, 'aA': 0.46280991735537191, 'AA': 0.13223140495867769 }, { 'aa': 0.39220487705336193, 'p': 0.37373737373737376, 'aA': 0.46811549841852879, 'AA': 0.13967962452810939 }, { 'aa': 0.37965513723089478, 'p': 0.38383838383838387, 'aA': 0.47301295786144271, 'AA': 0.14733190490766251 }, { 'aa': 0.36730945821854899, 'p': 0.39393939393939398, 'aA': 0.47750229568411384, 'AA': 0.15518824609733703 }, { 'aa': 0.35516784001632479, 'p': 0.40404040404040409, 'aA': 0.48158351188654219, 'AA': 0.16324864809713299 }, { 'aa': 0.34323028262422201, 'p': 0.4141414141414142, 'aA': 0.48525660646872776, 'AA': 0.17151311090705035 }, { 'aa': 0.33149678604224053, 'p': 0.42424242424242425, 'aA': 0.48852157943067032, 'AA': 0.1799816345270891 }, { 'aa': 0.31996735027038054, 'p': 0.43434343434343436, 'aA': 0.49137843077237014, 'AA': 0.18865421895724929 }, { 'aa': 0.30864197530864201, 'p': 0.44444444444444448, 'aA': 0.49382716049382724, 'AA': 0.19753086419753088 }, { 'aa': 0.29752066115702475, 'p': 0.45454545454545459, 'aA': 0.49586776859504134, 'AA': 0.20661157024793392 }, { 'aa': 0.2866034078155289, 'p': 0.4646464646464647, 'aA': 0.49750025507601259, 'AA': 0.21589633710845837 }, { 'aa': 0.27589021528415464, 'p': 0.47474747474747481, 'aA': 0.49872461993674116, 'AA': 0.22538516477910422 }, { 'aa': 0.26538108356290174, 'p': 0.48484848484848486, 'aA': 0.49954086317722679, 'AA': 0.23507805325987147 }, { 'aa': 0.25507601265177016, 'p': 0.49494949494949497, 'aA': 0.49994898479746958, 'AA': 0.24497500255076016 }, { 'aa': 0.2449750025507601, 'p': 0.50505050505050508, 'aA': 0.49994898479746963, 'AA': 0.25507601265177027 }, { 'aa': 0.23507805325987136, 'p': 0.51515151515151525, 'aA': 0.49954086317722679, 'AA': 0.26538108356290185 }, { 'aa': 0.22538516477910411, 'p': 0.5252525252525253, 'aA': 0.49872461993674116, 'AA': 0.27589021528415475 }, { 'aa': 0.21589633710845832, 'p': 0.53535353535353536, 'aA': 0.49750025507601264, 'AA': 0.28660340781552901 }, { 'aa': 0.20661157024793381, 'p': 0.54545454545454553, 'aA': 0.49586776859504134, 'AA': 0.29752066115702486 }, { 'aa': 0.19753086419753085, 'p': 0.55555555555555558, 'aA': 0.49382716049382713, 'AA': 0.30864197530864201 }, { 'aa': 0.18865421895724918, 'p': 0.56565656565656575, 'aA': 0.49137843077237014, 'AA': 0.3199673502703807 }, { 'aa': 0.17998163452708904, 'p': 0.5757575757575758, 'aA': 0.48852157943067032, 'AA': 0.33149678604224064 }, { 'aa': 0.17151311090705029, 'p': 0.58585858585858586, 'aA': 0.4852566064687277, 'AA': 0.34323028262422201 }, { 'aa': 0.16324864809713288, 'p': 0.59595959595959602, 'aA': 0.48158351188654219, 'AA': 0.35516784001632495 }, { 'aa': 0.155188246097337, 'p': 0.60606060606060608, 'aA': 0.47750229568411384, 'AA': 0.36730945821854916 }, { 'aa': 0.14733190490766243, 'p': 0.61616161616161624, 'aA': 0.47301295786144265, 'AA': 0.37965513723089489 }, { 'aa': 0.13967962452810934, 'p': 0.6262626262626263, 'aA': 0.46811549841852873, 'AA': 0.39220487705336193 }, { 'aa': 0.13223140495867761, 'p': 0.63636363636363646, 'aA': 0.46280991735537186, 'AA': 0.40495867768595056 }, { 'aa': 0.12498724619936737, 'p': 0.64646464646464652, 'aA': 0.4570962146719722, 'AA': 0.41791653912866039 }, { 'aa': 0.11794714825017855, 'p': 0.65656565656565657, 'aA': 0.45097439036832976, 'AA': 0.4310784613814917 }, { 'aa': 0.11111111111111106, 'p': 0.66666666666666674, 'aA': 0.44444444444444442, 'AA': 0.44444444444444453 }, { 'aa': 0.10447913478216507, 'p': 0.6767676767676768, 'aA': 0.4375063769003163, 'AA': 0.45801448831751868 }, { 'aa': 0.098051219263340414, 'p': 0.68686868686868696, 'aA': 0.43016018773594522, 'AA': 0.47178859300071435 }, { 'aa': 0.091827364554637247, 'p': 0.69696969696969702, 'aA': 0.42240587695133147, 'AA': 0.48576675849403128 }, { 'aa': 0.085807570656055432, 'p': 0.70707070707070718, 'aA': 0.41424344454647477, 'AA': 0.4999489847974698 }, { 'aa': 0.079991837567595106, 'p': 0.71717171717171724, 'aA': 0.40567289052137534, 'AA': 0.51433527191102957 }, { 'aa': 0.074380165289256187, 'p': 0.72727272727272729, 'aA': 0.39669421487603301, 'AA': 0.52892561983471076 }, { 'aa': 0.068972553821038618, 'p': 0.73737373737373746, 'aA': 0.38730741761044785, 'AA': 0.54372002856851354 }, { 'aa': 0.063769003162942539, 'p': 0.74747474747474751, 'aA': 0.37751249872461989, 'AA': 0.55871849811243757 }, { 'aa': 0.058769513314967811, 'p': 0.75757575757575768, 'aA': 0.36730945821854905, 'AA': 0.57392102846648319 }, { 'aa': 0.053974084277114552, 'p': 0.76767676767676774, 'aA': 0.35669829609223541, 'AA': 0.58932761963065006 }, { 'aa': 0.049382716049382713, 'p': 0.77777777777777779, 'aA': 0.34567901234567899, 'AA': 0.60493827160493829 }, { 'aa': 0.044995408631772232, 'p': 0.78787878787878796, 'aA': 0.33425160697887962, 'AA': 0.62075298438934812 }, { 'aa': 0.04081216202428322, 'p': 0.79797979797979801, 'aA': 0.32241607999183752, 'AA': 0.63677175798387919 }, { 'aa': 0.036832976226915587, 'p': 0.80808080808080818, 'aA': 0.31017243138455247, 'AA': 0.65299459238853197 }, { 'aa': 0.033057851239669402, 'p': 0.81818181818181823, 'aA': 0.29752066115702475, 'AA': 0.66942148760330589 }, { 'aa': 0.029486787062544598, 'p': 0.8282828282828284, 'aA': 0.28446076930925401, 'AA': 0.68605244362820139 }, { 'aa': 0.02611978369554125, 'p': 0.83838383838383845, 'aA': 0.27099275584124061, 'AA': 0.70288746046321815 }, { 'aa': 0.022956841138659312, 'p': 0.84848484848484851, 'aA': 0.25711662075298436, 'AA': 0.71992653810835638 }, { 'aa': 0.019997959391898759, 'p': 0.85858585858585867, 'aA': 0.24283236404448513, 'AA': 0.73716967656361609 }, { 'aa': 0.017243138455259654, 'p': 0.86868686868686873, 'aA': 0.22813998571574323, 'AA': 0.75461687582899717 }, { 'aa': 0.014692378328741939, 'p': 0.8787878787878789, 'aA': 0.21303948576675832, 'AA': 0.77226813590449972 }, { 'aa': 0.012345679012345664, 'p': 0.88888888888888895, 'aA': 0.19753086419753077, 'AA': 0.79012345679012352 }, { 'aa': 0.010203040506070784, 'p': 0.89898989898989912, 'aA': 0.18161412100806021, 'AA': 0.80818283848586903 }, { 'aa': 0.00826446280991734, 'p': 0.90909090909090917, 'aA': 0.16528925619834697, 'AA': 0.82644628099173567 }, { 'aa': 0.0065299459238853125, 'p': 0.91919191919191923, 'aA': 0.14855626976839093, 'AA': 0.84491378430772379 }, { 'aa': 0.004999489847974682, 'p': 0.92929292929292939, 'aA': 0.13141516171819184, 'AA': 0.8635853484338335 }, { 'aa': 0.0036730945821854847, 'p': 0.93939393939393945, 'aA': 0.11386593204775014, 'AA': 0.88246097337006435 }, { 'aa': 0.0025507601265176904, 'p': 0.94949494949494961, 'aA': 0.09590858075706539, 'AA': 0.9015406591164169 }, { 'aa': 0.0016324864809713236, 'p': 0.95959595959595967, 'aA': 0.077543107846138021, 'AA': 0.9208244056728907 }, { 'aa': 0.00091827364554637118, 'p': 0.96969696969696972, 'aA': 0.058769513314967811, 'AA': 0.94031221303948587 }, { 'aa': 0.00040812162024282867, 'p': 0.97979797979797989, 'aA': 0.03958779716355456, 'AA': 0.96000408121620262 }, { 'aa': 0.00010203040506070717, 'p': 0.98989898989898994, 'aA': 0.019997959391898697, 'AA': 0.97990001020304063 }, { 'aa': 0.0, 'p': 1.0, 'aA': 0.0, 'AA': 1.0 }];


// Setting up the margins and the graph area
var margin = { top: 20, right: 20, bottom: 50, left: 30 },
    width = 600 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

// Add the SVG element
var svg = d3.select('#hardyweinberg').append('svg')
    .attr('width', width + margin.left + margin.right)
    .attr('height', height + margin.top + margin.bottom)
    // Append a group element to SVG
    .append('g')
    // Translate that element to top left margin
    .attr('transform',
        'translate(' + margin.left + ',' + margin.top + ')')
    .style('margin', 'auto');

// Establish constants
var I = 200; //Number of cases of P
var N = 200;
var p = 0.5;

function choose_genotype(prob) {
    var len = Math.round(prob * 1000);
    var choices = [];
    for (i = 0; i < len; i++) {
        choices[i] = 'A';
    }
    for (i = len; i < 1000; i++) {
        choices[i] = 'a';
    }
    return [choices[Math.floor(Math.random() * 1000)], choices[Math.floor(Math.random() * 1000)]];
}

function cross(parent1, parent2) {
    offspring_1 = parent1[Math.floor(Math.random() * 2)];
    offspring_2 = parent2[Math.floor(Math.random() * 2)];
    offspring = [offspring_1, offspring_2];
    return offspring;
}

function random_mating(pop) {
    temp_pop = pop;
    for (i = 0; i < pop.length; i++) {
        offspring = cross(pop[Math.floor(Math.random() * N)], pop[Math.floor(Math.random() * N)]);
        temp_pop[i] = offspring;
    }
    pop = temp_pop;
}

experimental = [];
// Compute populations
for (m = 0; m < I; m++) {
    var pop = [];
    p = Math.random();
    for (j = 0; j < N; j++) {
        pop[j] = choose_genotype(p);
    }
    random_mating(pop);

    f_aa = 0;
    f_aA = 0;
    f_AA = 0;

    for (k = 0; k < N; k++) {
        if (pop[k][0] == 'A' && pop[k][1] == 'A') {
            f_AA = f_AA + 1;
        }
        if (pop[k][0] == 'a' && pop[k][1] == 'a') {
            f_aa = f_aa + 1;
        }
        if (pop[k][0] == 'a' && pop[k][1] == 'A') {
            f_aA = f_aA + 1;
        }
        if (pop[k][0] == 'A' && pop[k][1] == 'a') {
            f_aA = f_aA + 1;
        }
    }

    f_aa = f_aa / N;
    f_aA = f_aA / N;
    f_AA = f_AA / N;

    experimental[m] = { p: p, aa: f_aa, AA: f_AA, aA: f_aA }
}

// Set the ranges
var x = d3.scaleLinear().range([0, width]);
var y = d3.scaleLinear().range([height, 0]);

// Scale the range of the data
x.domain([0, 1]);
y.domain([0, 1]);

// Add the axes
svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x))
    .style('font', 'normal 12px Noto Serif');

svg.append("g")
    .call(d3.axisLeft(y))
    .style('font', 'normal 12px Noto Serif');

// Add the data points on SVG
svg.selectAll("dot")
    .data(experimental)
    .enter().append("circle")
    .attr("r", 3)
    .attr('stroke', '#118AB2')
    .attr('fill', '#118AB2')
    .attr("cx", function (d) { return x(d.p); }).attr("cy", function (d) { return y(d.aa); });

svg.selectAll("dot")
    .data(experimental)
    .enter().append("circle")
    .attr("r", 3)
    .attr('stroke', '#ffd166')
    .attr('fill', '#ffd166')
    .attr("cx", function (d) { return x(d.p); }).attr("cy", function (d) { return y(d.AA); });

svg.selectAll("dot")
    .data(experimental)
    .enter().append("circle")
    .attr("r", 3)
    .attr('stroke', 'red')
    .attr('fill', 'red')
    .attr("cx", function (d) { return x(d.p); }).attr("cy", function (d) { return y(d.aA); });

// update the elements
function update(value) {
    var I = value * 10;
    experimental = [];
    // Compute populations
    for (m = 0; m < I; m++) {
        var pop = [];
        p = Math.random();
        for (j = 0; j < N; j++) {
            pop[j] = choose_genotype(p);
        }
        random_mating(pop);

        f_aa = 0;
        f_aA = 0;
        f_AA = 0;

        for (k = 0; k < N; k++) {
            if (pop[k][0] == 'A' && pop[k][1] == 'A') {
                f_AA = f_AA + 1;
            }
            if (pop[k][0] == 'a' && pop[k][1] == 'a') {
                f_aa = f_aa + 1;
            }
            if (pop[k][0] == 'a' && pop[k][1] == 'A') {
                f_aA = f_aA + 1;
            }
            if (pop[k][0] == 'A' && pop[k][1] == 'a') {
                f_aA = f_aA + 1;
            }
        }

        f_aa = f_aa / N;
        f_aA = f_aA / N;
        f_AA = f_AA / N;

        experimental[m] = { p: p, aa: f_aa, AA: f_AA, aA: f_aA }
    }

    svg.selectAll("dot1")
        .data(experimental)
        .attr("r", 3)
        .attr('stroke', 'red')
        .attr('fill', 'red')
        .attr("cx", function (d) { return x(d.p); }).attr("cy", function (d) { return y(d.aA); });

    svg.selectAll("circle")
        .data(experimental)
        .attr("r", 3)
        .attr('stroke', '#118AB2')
        .attr('fill', '#118AB2')
        .attr("cx", function (d) { return x(d.p); }).attr("cy", function (d) { return y(d.aa); });

    svg.selectAll("circle")
        .data(experimental)
        .attr("r", 3)
        .attr('stroke', '#ffd166')
        .attr('fill', '#ffd166')
        .attr("cx", function (d) { return x(d.p); }).attr("cy", function (d) { return y(d.AA); });

}

// when the input range changes update the circle
d3.select("#slider").on("input", function () {
    update(+this.value);
});